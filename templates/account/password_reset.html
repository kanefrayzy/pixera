
{# FILE: templates/account/password_reset.html #}
{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Восстановление доступа — AI Gallery" %}{% endblock %}
{% block meta_description %}Восстановите доступ к аккаунту AI Gallery. Введите email для получения ссылки сброса пароля.{% endblock %}
{% block robots %}noindex, nofollow{% endblock %}

{% block hero %}
<!-- Compact Hero -->
<section class="py-12 sm:py-16 mt-8">
  <div class="container text-center">
    <h1 class="text-3xl sm:text-4xl font-bold mb-3">Восстановление пароля</h1>
    <p class="text-[var(--muted)] text-lg">Введите email для получения ссылки сброса пароля</p>
  </div>
</section>
{% endblock %}

{% block content %}
<div class="max-w-md mx-auto space-y-6">

  <!-- Messages -->
  {% include "includes/messages.html" %}

  <!-- Password Reset Form -->
  <div class="card p-6 sm:p-8">
    <div class="text-center mb-8">
      <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-primary/15 flex items-center justify-center">
        <svg class="w-8 h-8 text-primary" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 17C10.89 17 10 16.1 10 15C10 13.89 10.89 13 12 13C13.11 13 14 13.89 14 15C14 16.1 13.11 17 12 17M18 8C18 5.79 16.21 4 14 4H10C7.79 4 6 5.79 6 8V10H5C3.89 10 3 10.89 3 12V20C3 21.11 3.89 22 5 22H19C20.11 22 21 21.11 21 20V12C21 10.89 20.11 10 19 10H18V8M12 19C10.34 19 9 17.66 9 16C9 14.34 10.34 13 12 13C13.66 13 15 14.34 15 16C15 17.66 13.66 19 12 19M16 10H8V8C8 6.9 8.9 6 10 6H14C15.1 6 16 6.9 16 8V10Z"/>
        </svg>
      </div>
      <h2 class="text-xl font-semibold">Забыли пароль?</h2>
      <p class="text-sm text-[var(--muted)] mt-1">Мы поможем восстановить доступ к аккаунту</p>
    </div>

    <!-- Form Errors -->
    {% if form and form.non_field_errors %}
      <div class="mb-6 p-4 rounded-xl border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20">
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
            <path d="M13 14H11V9H13M13 18H11V16H13M1 21H23L12 2L1 21Z"/>
          </svg>
          <div class="text-sm text-red-700 dark:text-red-300">
            {% for e in form.non_field_errors %}{{ e }}{% endfor %}
          </div>
        </div>
      </div>
    {% endif %}

    <form method="post"
          action="{% url 'account_reset_password' %}"
          novalidate
          class="space-y-6">
      {% csrf_token %}

      <!-- Email Field -->
      <div>
        <label class="block text-sm font-medium mb-2" for="id_email">
          Email адрес
        </label>
        {% if form and form.email %}
          <input class="field {% if form.email.errors %}border-red-500 focus:border-red-500 focus:ring-red-500/30{% endif %}"
                 type="email"
                 name="email"
                 id="{{ form.email.id_for_label }}"
                 value="{{ form.email.value|default_if_none:'' }}"
                 placeholder="Введите ваш email"
                 autofocus
                 required>
          {% if form.email.errors %}
            <div class="mt-2 text-sm text-red-600 dark:text-red-400">
              {% for error in form.email.errors %}{{ error }}{% endfor %}
            </div>
          {% endif %}
        {% else %}
          <input class="field"
                 type="email"
                 name="email"
                 id="id_email"
                 placeholder="Введите ваш email"
                 autofocus
                 required>
        {% endif %}
        <p class="mt-2 text-sm text-[var(--muted)]">
          Мы отправим письмо со ссылкой для сброса. Проверьте также папку «Спам».
        </p>
      </div>

      <!-- Submit Button -->
      <button class="btn btn-primary w-full text-base py-3" type="submit">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        </svg>
        Отправить ссылку
      </button>
    </form>
  </div>

  <!-- Back to Login -->
  <div class="text-center">
    <a class="text-primary hover:text-primary/80 transition font-medium inline-flex items-center gap-2"
       href="{% url 'account_login' %}">
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Вернуться ко входу
    </a>
  </div>

  <!-- Help Text -->
  <div class="card p-4 border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">
    <div class="flex items-start gap-3">
      <svg class="w-5 h-5 text-gray-500 mt-0.5 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
        <path d="M13 9H11V7H13M13 17H11V15H13M12 2A10 10 0 0 0 2 12A10 10 0 0 0 12 22A10 10 0 0 0 22 12A10 10 0 0 0 12 2Z"/>
      </svg>
      <div class="text-sm text-gray-600 dark:text-gray-400">
        <div class="font-medium mb-1">Не приходит письмо?</div>
        <p>Проверьте папку спам или попробуйте ещё раз через несколько минут. Если проблема сохраняется, убедитесь, что email введён правильно.</p>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.querySelector('form');
  const submitBtn = form.querySelector('button[type="submit"]');
  const emailInput = form.querySelector('input[type="email"]');

  // Email validation
  emailInput.addEventListener('blur', () => {
    validateEmail(emailInput);
  });

  emailInput.addEventListener('input', () => {
    if (emailInput.classList.contains('border-red-500')) {
      emailInput.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500/30');
    }
  });

  function validateEmail(field) {
    const isValid = field.checkValidity() && field.value.includes('@');

    if (!isValid && field.value) {
      field.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-500/30');
    } else {
      field.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500/30');
    }
  }

  // Submit button loading state
  form.addEventListener('submit', (e) => {
    const originalText = submitBtn.innerHTML;

    if (emailInput.checkValidity() && emailInput.value.includes('@')) {
      submitBtn.disabled = true;
      submitBtn.innerHTML = `
        <svg class="w-5 h-5 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Отправляем...
      `;

      setTimeout(() => {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
      }, 10000);
    } else {
      e.preventDefault();
      validateEmail(emailInput);
      emailInput.focus();
    }
  });
});
</script>

{% endblock %}
