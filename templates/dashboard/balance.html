{% extends "dashboard/layout.html" %}
{% load static %}
{% load i18n %}

{% block title %}Мой баланс — AI Gallery{% endblock %}

{% block dash %}
<div class="max-w-4xl mx-auto space-y-8">

  <!-- Header -->
  <div>
    <h1 class="text-3xl font-bold">Мой баланс</h1>
    <p class="text-[var(--muted)] mt-2">Управляйте токенами и выбирайте тарифы для генерации изображений</p>
  </div>

  <!-- Balance Card -->
  <div class="card p-6 sm:p-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6">
      
      <!-- User Info -->
      <div class="flex items-center gap-4">
        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center text-white font-bold text-xl">
          {{ request.user.first_name|first|default:request.user.username|first|upper }}
        </div>
        <div>
          <div class="text-sm text-[var(--muted)]">Пользователь</div>
          <div class="font-semibold text-lg">@{{ request.user.get_username }}</div>
        </div>
      </div>

      <!-- Balance Display -->
      <div class="text-center sm:text-right">
        <div class="text-sm text-[var(--muted)] mb-2">Текущий баланс</div>
        {% if request.user.is_staff %}
          <div class="text-3xl font-bold text-primary mb-1">∞</div>
          <div class="text-sm text-[var(--muted)]">Безлимитный доступ</div>
        {% else %}
          <div class="flex items-center justify-center sm:justify-end gap-2 mb-2">
            <div class="w-8 h-8 rounded-xl bg-primary/15 flex items-center justify-center">
              <svg class="w-4 h-4 text-primary" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V19A2 2 0 0 0 5 21H19A2 2 0 0 0 21 19V9M19 9H14V4H15.83L19 7.17V9Z"/>
              </svg>
            </div>
            <div class="text-3xl font-bold">{{ wallet.balance|default:0 }}</div>
            <div class="text-lg text-[var(--muted)]">TOK</div>
          </div>
          {% with price=TOKENS_PRICE_PER_GEN|default:10 %}
            {% widthratio wallet.balance|default:0 price 1 as gens_left %}
            <div class="text-sm text-[var(--muted)]">
              ≈ {{ gens_left|default:0 }} обработок (1 обработка = {{ price }} TOK)
            </div>
          {% endwith %}
        {% endif %}
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row gap-3 mt-6 pt-6 border-t border-[var(--bord)]">
      {% if not request.user.is_staff %}
        <a class="btn btn-primary" href="{% url 'dashboard:billing' %}">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          Пополнить баланс
        </a>
      {% endif %}
      <a class="btn btn-ghost" href="{% url 'generate:new' %}">
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        Создать изображение
      </a>
    </div>
  </div>

  <!-- Usage Tips -->
  <div class="card p-6 border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20">
    <div class="flex items-start gap-3">
      <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
        <path d="M13 9H11V7H13M13 17H11V15H13M12 2A10 10 0 0 0 2 12A10 10 0 0 0 12 22A10 10 0 0 0 22 12A10 10 0 0 0 12 2Z"/>
      </svg>
      <div class="text-sm">
        <div class="font-medium text-blue-800 dark:text-blue-200 mb-2">Как эффективно использовать токены</div>
        <ul class="text-blue-700 dark:text-blue-300 space-y-1">
          <li>• Детализированные промпты дают лучшие результаты</li>
          <li>• Экспериментируйте с разными стилями и параметрами</li>
          <li>• Сохраняйте удачные промпты для повторного использования</li>
          <li>• Публикуйте лучшие работы в галерее</li>
        </ul>
      </div>
    </div>
  </div>

</div>

<style>
/* Smooth transitions for all interactive elements */
.card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
  transform: translateY(-2px);
}

/* Gradient avatar animation */
.bg-gradient-to-br {
  position: relative;
  overflow: hidden;
}

.bg-gradient-to-br::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s ease;
}

.bg-gradient-to-br:hover::before {
  left: 100%;
}

/* Enhanced hover states */
.group:hover .group-hover\:bg-primary\/25 {
  background-color: rgba(1, 209, 251, 0.25);
}

/* Button loading state */
.btn:active {
  transform: scale(0.98);
}

/* Mobile optimizations */
@media (max-width: 640px) {
  .text-3xl {
    font-size: 1.875rem;
    line-height: 2.25rem;
  }
  
  .space-y-8 > * + * {
    margin-top: 1.5rem;
  }
}

/* Better focus states for accessibility */
.btn:focus {
  outline: 2px solid rgb(1 209 251);
  outline-offset: 2px;
}

/* Animation for statistics */
@keyframes countUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.card:hover .font-medium {
  animation: countUp 0.3s ease;
}
</style>

{% endblock %}