{% extends "dashboard/layout.html" %}
{% load static %}
{% load i18n %}

{% block title %}Мой баланс — Pixera{% endblock %}

{% block dash %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 space-y-6 sm:space-y-8">

  <!-- Header -->
  <div class="space-y-2">
    <h1 class="text-2xl sm:text-3xl font-bold leading-tight">Мой баланс</h1>
    <p class="text-[var(--muted)] text-sm sm:text-base leading-relaxed">Управляйте токенами и выбирайте тарифы для генерации изображений</p>
  </div>

  <!-- Balance Card -->
  <div class="card p-5 sm:p-6 lg:p-8">
    <!-- User Info Section -->
    <div class="flex items-center gap-4 pb-5 border-b border-[var(--bord)]">
      <div class="w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center text-white font-bold text-xl flex-shrink-0">
        {{ request.user.first_name|first|default:request.user.username|first|upper }}
      </div>
      <div class="min-w-0 flex-1">
        <div class="text-xs sm:text-sm text-[var(--muted)]">Пользователь</div>
        <div class="font-semibold text-lg sm:text-xl truncate">@{{ request.user.get_username }}</div>
      </div>
    </div>

    <!-- Balance Display Section -->
    <div class="py-6">
      <div class="text-sm text-[var(--muted)] mb-3">Текущий баланс</div>
      {% if request.user.is_staff %}
        <div class="flex items-center gap-3 mb-3">
          <div class="text-4xl sm:text-5xl font-bold text-primary">∞</div>
        </div>
        <div class="text-sm text-[var(--muted)]">Безлимитный доступ</div>
      {% else %}
        <div class="flex items-center gap-3 mb-3">
          <div class="w-12 h-12 rounded-xl bg-primary/15 flex items-center justify-center flex-shrink-0">
            <svg class="w-6 h-6 text-primary" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V19A2 2 0 0 0 5 21H19A2 2 0 0 0 21 19V9M19 9H14V4H15.83L19 7.17V9Z"/>
            </svg>
          </div>
          <div>
            <div class="flex items-baseline gap-2">
              <span class="text-4xl sm:text-5xl font-bold">{{ wallet.balance|default:0 }}</span>
              <span class="text-xl text-[var(--muted)]">TOK</span>
            </div>
          </div>
        </div>
        {% with price=TOKENS_PRICE_PER_GEN|default:10 %}
          {% widthratio wallet.balance|default:0 price 1 as gens_left %}
          <div class="text-sm text-[var(--muted)]">
            ≈ {{ gens_left|default:0 }} обработок (1 обработка = {{ price }} TOK)
          </div>
        {% endwith %}
      {% endif %}
    </div>

    <!-- Action Buttons -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 pt-5 border-t border-[var(--bord)]">
      {% if not request.user.is_staff %}
        <a class="btn btn-primary justify-center h-12" href="{% url 'dashboard:billing' %}">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          <span class="font-medium">Пополнить баланс</span>
        </a>
      {% endif %}
      <a class="btn btn-ghost justify-center h-12" href="{% url 'generate:new' %}">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        <span class="font-medium">Создать изображение</span>
      </a>
    </div>
  </div>

  <!-- Usage Tips -->
  <div class="card p-5 sm:p-6 border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20">
    <div class="flex items-start gap-3">
      <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
        <path d="M13 9H11V7H13M13 17H11V15H13M12 2A10 10 0 0 0 2 12A10 10 0 0 0 12 22A10 10 0 0 0 22 12A10 10 0 0 0 12 2Z"/>
      </svg>
      <div class="text-sm flex-1">
        <div class="font-medium text-blue-800 dark:text-blue-200 mb-2">Как эффективно использовать токены</div>
        <ul class="text-blue-700 dark:text-blue-300 space-y-1">
          <li>• Детализированные промпты дают лучшие результаты</li>
          <li>• Экспериментируйте с разными стилями и параметрами</li>
          <li>• Сохраняйте удачные промпты для повторного использования</li>
          <li>• Публикуйте лучшие работы в галерее</li>
        </ul>
      </div>
    </div>
  </div>

</div>

<style>
/* Smooth transitions for all interactive elements */
.card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
  transform: translateY(-2px);
}

/* Gradient avatar animation */
.bg-gradient-to-br {
  position: relative;
  overflow: hidden;
}

.bg-gradient-to-br::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s ease;
}

.bg-gradient-to-br:hover::before {
  left: 100%;
}

/* Enhanced hover states */
.group:hover .group-hover\:bg-primary\/25 {
  background-color: rgba(1, 209, 251, 0.25);
}

/* Button loading state */
.btn:active {
  transform: scale(0.98);
}

/* Mobile optimizations */
@media (max-width: 640px) {
  /* Disable hover animations on mobile */
  .card:hover {
    transform: none;
  }
  
  .bg-gradient-to-br:hover::before {
    left: -100%;
  }
  
  /* Better touch targets */
  .btn {
    min-height: 48px;
    font-size: 15px;
  }
  
  /* Ensure buttons are always visible and full width */
  .btn-primary,
  .btn-ghost {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }
  
  /* Better card padding on mobile */
  .card {
    margin-left: -1rem;
    margin-right: -1rem;
    border-radius: 0;
    border-left: none;
    border-right: none;
  }
  
  /* Prevent text overflow */
  h1, .font-bold {
    word-break: break-word;
  }
}

/* Better focus states for accessibility */
.btn:focus {
  outline: 2px solid rgb(1 209 251);
  outline-offset: 2px;
}

/* Animation for statistics */
@keyframes countUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.card:hover .font-medium {
  animation: countUp 0.3s ease;
}
</style>

{% endblock %}