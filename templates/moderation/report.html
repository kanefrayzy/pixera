{# FILE: templates/moderation/report.html #}
{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Report — AI Gallery" %}{% endblock %}

{% block hero %}
<section class="hero hero--compact">
  <div class="container hero-inner">
    <h1 class="hero-title">{% trans "Report image" %}</h1>
  </div>
</section>
{% endblock %}

{% block content %}
<section class="container" style="max-width:820px;margin-inline:auto;display:grid;gap:1rem">
  <figure class="panel" style="padding:12px">
    <img
      src="{{ image.image.url }}"
      alt="{% blocktrans with t=image.title|default:_('Image') %}Preview: {{ t }}{% endblocktrans %}"
      style="max-height:320px;width:auto;border-radius:12px;border:1px solid var(--border,#2b2b31);background:var(--card,#0f0f14);display:block;margin-inline:auto"
    />
    {% if image.title %}
      <figcaption class="muted" style="text-align:center;margin-top:.5rem">{{ image.title }}</figcaption>
    {% endif %}
  </figure>

  <form method="post" class="panel" role="form" aria-labelledby="reportTitle" novalidate style="display:grid;gap:1rem;max-width:640px;margin-inline:auto">
    {% csrf_token %}
    <h2 id="reportTitle" class="h3" style="margin:0">{% trans "Submit a report" %}</h2>

    {# Ошибки формы сверху #}
    {% if form.non_field_errors %}
      <div class="flash flash-error" role="alert">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    {# Рендерим поля по одному, чтобы добавить aria-атрибуты #}
    {% for field in form %}
      <div class="form-row" style="display:grid;gap:.35rem">
        <label for="{{ field.id_for_label }}" class="label">
          {{ field.label|default:field.name }}
          {% if field.field.required %}<span aria-hidden="true" style="opacity:.7"> *</span>{% endif %}
        </label>
        {{ field }}
        {% if field.help_text %}
          <div class="help muted" id="{{ field.id_for_label }}_help">{{ field.help_text|safe }}</div>
        {% endif %}
        {% if field.errors %}
          <div class="error" role="alert" style="color:#ef4444">{{ field.errors }}</div>
        {% endif %}
      </div>
    {% endfor %}

    <div class="form-actions" style="display:flex;gap:.5rem;align-items:center">
      <button class="btn btn-grad" type="submit">{% trans "Submit report" %}</button>
      {% firstof request.GET.next request.META.HTTP_REFERER "/" as back_url %}
      <a class="btn btn-soft" href="{{ back_url }}">{% trans "Cancel" %}</a>
    </div>
  </form>

  <p class="muted" style="text-align:center;font-size:.9rem">
    {% trans "We review reports promptly to keep the gallery safe and SFW." %}
  </p>
</section>
{% endblock %}
