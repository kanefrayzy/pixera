# Generated migration for file-based prompt categories

from django.db import migrations
from django.core.files import File
from pathlib import Path
import os


def create_categories_from_files(apps, schema_editor):
    """Обновляет существующие категории промптов"""
    PromptCategory = apps.get_model('generate', 'PromptCategory')

    # Список категорий из файлов
    category_names = [
        'абстракция', 'Архитектура', 'будущее', 'винтаж', 'времена года', 'города',
        'детство', 'для разработки', 'еда', 'животные', 'интерьер', 'исскуство',
        'история', 'космос', 'макросъемка', 'медитация', 'минимализм', 'мифология',
        'мода', 'музыка', 'наука', 'ночь', 'пейзажи', 'подводный мир', 'портреты',
        'праздники', 'приключения', 'природа', 'профессии', 'романтика', 'свет и тень',
        'спорт', 'текстуры', 'технологии', 'транспорт', 'уют', 'Фэнтези', 'экстрим',
        'эмоции', 'Эстетика'
    ]

    # Описания для категорий
    descriptions = {
        'абстракция': 'Абстрактные формы и композиции',
        'Архитектура': 'Здания, сооружения и архитектурные детали',
        'будущее': 'Футуристические сцены и технологии',
        'винтаж': 'Ретро стиль и винтажная эстетика',
        'времена года': 'Сезонные пейзажи и атмосфера',
        'города': 'Городские пейзажи и урбанистика',
        'детство': 'Детские моменты и воспоминания',
        'для разработки': 'Технические и концептуальные изображения',
        'еда': 'Кулинарные шедевры и гастрономия',
        'животные': 'Дикая природа и домашние питомцы',
        'интерьер': 'Дизайн интерьеров и пространств',
        'исскуство': 'Художественные произведения и стили',
        'история': 'Исторические сцены и эпохи',
        'космос': 'Космические пейзажи и астрономия',
        'макросъемка': 'Детальные крупные планы',
        'медитация': 'Спокойствие и умиротворение',
        'минимализм': 'Простота и лаконичность',
        'мифология': 'Мифические существа и легенды',
        'мода': 'Модные образы и стиль',
        'музыка': 'Музыкальные инструменты и концерты',
        'наука': 'Научные концепции и открытия',
        'ночь': 'Ночные сцены и освещение',
        'пейзажи': 'Природные ландшафты',
        'подводный мир': 'Океаны и морская жизнь',
        'портреты': 'Портретная фотография',
        'праздники': 'Праздничные моменты и торжества',
        'приключения': 'Путешествия и экспедиции',
        'природа': 'Естественная красота природы',
        'профессии': 'Различные профессии и занятия',
        'романтика': 'Романтические сцены и настроение',
        'свет и тень': 'Игра света и теней',
        'спорт': 'Спортивные моменты и активность',
        'текстуры': 'Материалы и поверхности',
        'технологии': 'Современные технологии',
        'транспорт': 'Автомобили, поезда и другой транспорт',
        'уют': 'Уютные и комфортные сцены',
        'Фэнтези': 'Фантастические миры и существа',
        'экстрим': 'Экстремальные виды спорта',
        'эмоции': 'Выражение чувств и эмоций',
        'Эстетика': 'Визуальная гармония и красота'
    }

    print('Обновление категорий...')
    for order, name in enumerate(category_names, start=1):
        # Обновляем или создаем категорию
        try:
            category, created = PromptCategory.objects.get_or_create(
                name=name,
                defaults={
                    'description': descriptions.get(name, f'Промпты в категории {name}'),
                    'order': order,
                    'is_active': True
                }
            )
            # Обновляем существующую категорию
            if not created:
                category.description = descriptions.get(name, f'Промпты в категории {name}')
                category.order = order
                category.is_active = True
                category.save()

            if created:
                print(f'✅ Создана категория: {name}')
            else:
                print(f'ℹ️  Обновлена категория: {name}')
        except Exception as e:
            print(f'⚠️  Ошибка при обработке категории {name}: {e}')


def reverse_migration(apps, schema_editor):
    """Откат миграции - удаляет созданные категории"""
    PromptCategory = apps.get_model('generate', 'PromptCategory')

    category_names = [
        'абстракция', 'Архитектура', 'будущее', 'винтаж', 'времена года', 'города',
        'детство', 'для разработки', 'еда', 'животные', 'интерьер', 'исскуство',
        'история', 'космос', 'макросъемка', 'медитация', 'минимализм', 'мифология',
        'мода', 'музыка', 'наука', 'ночь', 'пейзажи', 'подводный мир', 'портреты',
        'праздники', 'приключения', 'природа', 'профессии', 'романтика', 'свет и тень',
        'спорт', 'текстуры', 'технологии', 'транспорт', 'уют', 'Фэнтези', 'экстрим',
        'эмоции', 'Эстетика'
    ]

    PromptCategory.objects.filter(name__in=category_names).delete()


class Migration(migrations.Migration):

    dependencies = [
        ('generate', '0018_fill_final_english_prompts_part3'),
    ]

    operations = [
        migrations.RunPython(create_categories_from_files, reverse_migration),
    ]
