# Настройка DeepL Translate для автоматического перевода промптов

## Обзор

Система теперь автоматически переводит промпты пользователей с любого языка на английский перед отправкой в AI генерацию. Это улучшает качество генерации, так как большинство AI моделей лучше работают с английскими промптами.

## Как это работает

1. Пользователь вводит промпт на любом языке (русский, китайский, арабский и т.д.)
2. Система автоматически определяет язык промпта
3. Если промпт не на английском, он переводится с помощью DeepL API
4. Оригинальный промпт сохраняется в базе данных для отображения пользователю
5. Переведенный промпт отправляется в AI модель для генерации

## Настройка

### 1. Получение API ключа DeepL

1. Зарегистрируйтесь на [DeepL](https://www.deepl.com/pro-api)
2. Выберите подходящий план:
   - **Free**: 500,000 символов в месяц (бесплатно)
   - **Pro**: неограниченное количество символов
3. Получите API ключ из личного кабинета

### 2. Настройка переменных окружения

Добавьте API ключ в ваш `.env` файл:

```bash
DEEPL_API_KEY=your-deepl-api-key-here
```

### 3. Перезапуск приложения

После добавления API ключа перезапустите Django приложение:

```bash
python manage.py runserver
```

## Особенности реализации

### Автоопределение языка
- Система автоматически определяет, является ли промпт английским
- Если более 80% символов - английские, перевод не требуется
- В противном случае промпт отправляется на перевод

### Обработка ошибок
- Если DeepL API недоступен, система использует оригинальный промпт
- Все ошибки логируются для диагностики
- Пользователь всегда получит результат, даже если перевод не удался

### Сохранение данных
- Оригинальный промпт сохраняется в поле `original_prompt`
- Переведенный промпт сохраняется в поле `prompt`
- Это позволяет отображать пользователю его оригинальный ввод

## Мониторинг

### Логи
Все операции перевода логируются в Django логах:

```bash
# Просмотр логов перевода
tail -f logs/django.log | grep "translate"
```

### Использование API
Следите за использованием лимитов DeepL API в личном кабинете.

## Стоимость

### DeepL Free Plan
- 500,000 символов в месяц
- Идеально для тестирования и небольших проектов
- Автоматически обновляется каждый месяц

### DeepL Pro Plan
- Неограниченное количество символов
- Приоритетная обработка запросов
- Рекомендуется для коммерческих проектов

## Отключение перевода

Если временно нужно отключить перевод, просто удалите или закомментируйте переменную:

```bash
# DEEPL_API_KEY=your-deepl-api-key-here
```

Система будет работать в обычном режиме без перевода.

## Поддерживаемые языки

DeepL поддерживает перевод между множеством языков включая:
- Русский
- Китайский (упрощенный и традиционный)
- Японский
- Корейский
- Арабский
- Испанский
- Французский
- Немецкий
- И многие другие

Полный список доступных языков: [DeepL Supported Languages](https://www.deepl.com/languages)

## Troubleshooting

### Проблема: Перевод не работает
1. Проверьте, что API ключ правильно добавлен в `.env`
2. Убедитесь, что есть доступ к интернету
3. Проверьте логи на наличие ошибок

### Проблема: Достигнут лимит API
1. Проверьте использование в личном кабинете DeepL
2. Рассмотрите обновление до Pro плана
3. Дождитесь следующего месяца (для Free плана)

### Проблема: Качество перевода
DeepL обеспечивает высокое качество перевода, но если вы столкнулись с проблемами:
1. Проверьте оригинальный промпт на наличие опечаток
2. Попробуйте переформулировать запрос
3. Используйте более простые конструкции

## Техническая реализация

Файлы системы перевода:
- `generate/services/translator.py` - основной сервис перевода
- `generate/views_api.py` - интеграция в API обработки формы
- `generate/models.py` - модель с сохранением оригинального промпта

Ключевые компоненты:
- `DeepLTranslator` - класс для работы с DeepL API
- `translate_prompt_if_needed()` - удобная функция для перевода
- Автоматическое определение необходимости перевода
- Graceful fallback при ошибках
