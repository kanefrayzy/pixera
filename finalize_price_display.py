#!/usr/bin/env python3
"""
–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–µ–Ω—ã:
1. –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ image-price-calculator.js –≤ —à–∞–±–ª–æ–Ω
2. –û–±–Ω–æ–≤–ª—è–µ—Ç HTML –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ü–µ–Ω—ã
"""

import re

print("üé® –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–µ–Ω—ã...")

# –ß–∏—Ç–∞–µ–º —à–∞–±–ª–æ–Ω
with open('templates/generate/new.html', 'r', encoding='utf-8') as f:
    content = f.read()

# 1. –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
print("\n1Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞...")

script_line = '<script src="{% static \'js/image-price-calculator.js\' %}?v={{ STATIC_VERSION }}" defer></script>'

if script_line not in content:
    # –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ update-image-model-info.js
    pattern = r"(<script src=\"{% static 'js/update-image-model-info\.js' %})"
    replacement = script_line + '\n' + r'\1'
    content = re.sub(pattern, replacement, content)
    print("‚úÖ –°–∫—Ä–∏–ø—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω")
else:
    print("‚ÑπÔ∏è  –°–∫—Ä–∏–ø—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —É–∂–µ –ø–æ–¥–∫–ª—é—á—ë–Ω")

# 2. –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á—ë—Ç–æ–º
print("\n2Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏...")

# –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–µ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
old_cost_display = r'<span id="current-model-cost">{% with c=price\|default:TOKENS_PRICE_PER_GEN\|default:10 %}{{ c }}{% endwith %}</span>'

new_cost_display = '''<span id="total-cost-display">
              <span id="current-model-cost">{% with c=price|default:TOKENS_PRICE_PER_GEN|default:10 %}{{ c }}{% endwith %}</span> TOK
            </span>'''

if 'total-cost-display' not in content:
    content = content.replace(old_cost_display, new_cost_display)
    print("‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–æ")
else:
    print("‚ÑπÔ∏è  –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ")

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
with open('templates/generate/new.html', 'w', encoding='utf-8') as f:
    f.write(content)

print("\n‚úÖ –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
print("\nüìã –ò—Ç–æ–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:")
print("1. ‚úÖ –ü–æ–¥–∫–ª—é—á—ë–Ω —Å–∫—Ä–∏–ø—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ —Ü–µ–Ω—ã")
print("2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏")
print("\nüéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:")
print("- –¶–µ–Ω–∞ —Ç–µ–ø–µ—Ä—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è: –±–∞–∑–æ–≤–∞—è_—Ü–µ–Ω–∞ √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")
print("- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ü–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è")
