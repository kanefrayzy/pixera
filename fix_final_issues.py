#!/usr/bin/env python3
"""
–§–∏–Ω–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤ (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö)
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã
"""

print("üîß –§–∏–Ω–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è...\n")

# 1. –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤
print("1Ô∏è‚É£ –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤...")

with open('templates/generate/new.html', 'r', encoding='utf-8') as f:
    content = f.read()

# –ò—â–µ–º –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è include —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤
import re
pattern = r"{% include 'generate/reference_upload_compact\.html' with target_id='image' %}"
matches = list(re.finditer(pattern, content))

print(f"   –ù–∞–π–¥–µ–Ω–æ –≤—Ö–æ–∂–¥–µ–Ω–∏–π: {len(matches)}")

if len(matches) > 1:
    # –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ (–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö)
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ
    for i in range(len(matches) - 1):
        match = matches[i]
        # –ù–∞—Ö–æ–¥–∏–º –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏ —Å —ç—Ç–∏–º include
        start = content.rfind('\n', 0, match.start()) + 1
        # –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏
        end = content.find('\n', match.end())
        if end == -1:
            end = len(content)
        else:
            end += 1

        # –£–¥–∞–ª—è–µ–º —Å—Ç—Ä–æ–∫—É
        line_to_remove = content[start:end]
        content = content.replace(line_to_remove, '', 1)
        print(f"   ‚úÖ –£–¥–∞–ª–µ–Ω–æ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ {i+1}")

    print(f"   ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ 1 –≤—Ö–æ–∂–¥–µ–Ω–∏–µ (–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö)")
else:
    print("   ‚ÑπÔ∏è  –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Ç")

# –°–æ—Ö—Ä–∞–Ω—è–µ–º
with open('templates/generate/new.html', 'w', encoding='utf-8') as f:
    f.write(content)

print("\n2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã...")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ image-price-calculator.js
with open('templates/generate/new.html', 'r', encoding='utf-8') as f:
    content = f.read()

if 'image-price-calculator.js' in content:
    print("   ‚úÖ –°–∫—Ä–∏–ø—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Ü–µ–Ω—ã –ø–æ–¥–∫–ª—é—á–µ–Ω")
else:
    print("   ‚ùå –°–∫—Ä–∏–ø—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Ü–µ–Ω—ã –ù–ï –ø–æ–¥–∫–ª—é—á–µ–Ω!")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º update-image-model-info.js
if 'update-image-model-info.js' in content:
    print("   ‚úÖ –°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω")
else:
    print("   ‚ùå –°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ù–ï –ø–æ–¥–∫–ª—é—á–µ–Ω!")

print("\n‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã!")
print("\n–†–µ–∑—É–ª—å—Ç–∞—Ç:")
print("1. ‚úÖ –†–µ—Ñ–µ—Ä–µ–Ω—Å—ã —Ç–æ–ª—å–∫–æ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö")
print("2. ‚úÖ –¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏")
print("3. ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ")
