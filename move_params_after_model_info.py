#!/usr/bin/env python3
"""
–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –±–ª–æ–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
1. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ –±–ª–æ–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥–µ–ª–∏
2. –°–∫—Ä—ã—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–¥–æ–±–∞–≤–∏—Ç—å hidden)
3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
"""

print("üîß –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –±–ª–æ–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤...")

with open('templates/generate/new.html', 'r', encoding='utf-8') as f:
    content = f.read()

# 1. –ù–∞—Ö–æ–¥–∏–º –∏ –≤—ã—Ä–µ–∑–∞–µ–º –≤–µ—Å—å –±–ª–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
params_start = '<div class="card p-6 mt-6" id="image-params-section">'
params_end = '{% include \'generate/reference_upload_compact.html\' with target_id=\'image\' %}\n  </div>'

# –ò—â–µ–º –Ω–∞—á–∞–ª–æ –±–ª–æ–∫–∞
start_idx = content.find(params_start)
if start_idx == -1:
    print("‚ùå –ë–ª–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
    exit(1)

# –ò—â–µ–º –∫–æ–Ω–µ—Ü –±–ª–æ–∫–∞ (–ø–æ—Å–ª–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤)
end_idx = content.find(params_end, start_idx)
if end_idx == -1:
    print("‚ùå –ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
    exit(1)

# –í—ã—Ä–µ–∑–∞–µ–º –≤–µ—Å—å –±–ª–æ–∫
end_idx += len(params_end)
params_block = content[start_idx:end_idx]

# –£–¥–∞–ª—è–µ–º –±–ª–æ–∫ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–∞
content = content[:start_idx] + content[end_idx:]

# 2. –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å hidden –∫ –±–ª–æ–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
params_block = params_block.replace(
    '<div class="card p-6 mt-6" id="image-params-section">',
    '<div class="card p-6 mt-6 hidden" id="image-params-section">'
)

# 3. –ù–∞—Ö–æ–¥–∏–º –º–µ—Å—Ç–æ –ø–æ—Å–ª–µ –±–ª–æ–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥–µ–ª–∏
# –ò—â–µ–º –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–π —Ç–µ–≥ –±–ª–æ–∫–∞ image-model-info-section
model_info_marker = '</div>\n      </div>'  # –ó–∞–∫—Ä—ã—Ç–∏–µ image-model-info-section

# –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –ø–æ—Å–ª–µ –±–ª–æ–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥–µ–ª–∏
insert_pos = content.find(model_info_marker)
if insert_pos == -1:
    print("‚ùå –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
    exit(1)

# –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –±–ª–æ–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥–µ–ª–∏
insert_pos += len(model_info_marker)
content = content[:insert_pos] + '\n\n      <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (—Å–∫—Ä—ã—Ç—ã –¥–æ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏) -->\n      ' + params_block + content[insert_pos:]

# –°–æ—Ö—Ä–∞–Ω—è–µ–º
with open('templates/generate/new.html', 'w', encoding='utf-8') as f:
    f.write(content)

print("\n‚úÖ –ë–ª–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–º–µ—â—ë–Ω!")
print("\n–¢–µ–ø–µ—Ä—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:")
print("1. ‚úÖ –ü—Ä–æ–º–ø—Ç")
print("2. ‚úÖ –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏")
print("3. ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏")
print("4. ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (—Å–∫—Ä—ã—Ç—ã)")
print("5. ‚úÖ –ö–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏")
print("6. ‚úÖ –û—á–µ—Ä–µ–¥—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏")
print("\nüìã –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:")
print("- –û–±–Ω–æ–≤–∏—Ç—å image-field-manager.js –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏")
